import React, { useRef, useState } from 'react';
import { Link } from 'react-router-dom';
import { useSelector } from 'react-redux';
import {
  HeaderModule,
  HeaderButton,
  HeaderLogo,
  HeaderLogin,
  Header as ConstaHeader,
} from '@consta/uikit/Header';
import { IconHamburger } from '@consta/uikit/IconHamburger';
import useResolution from '../../../hooks/useResolution';
import useStyles from './styles';
import { RootState } from '../../../store/reducers/rootReducer';
import { SetStateType } from '../../../types/common';
import Typography from '../../Common/Typography';
import bitcoin from '../../../assets/images/bitcoin.png';
import UserDropdown from './UserDropdown';

interface IHeaderProps {
  theme: 'default' | 'dark';
  setTheme: SetStateType<'default' | 'dark'>;
  toggleMenu: VoidFunction;
}

const Header = ({ theme, setTheme, toggleMenu }: IHeaderProps) => {
  const styles = useStyles();
  const [isOpen, setOpen] = useState(false);
  const { isLogged, profile } = useSelector((state: RootState) => state.user);
  const ref = useRef<HTMLDivElement>(null);
  const isMobile = useResolution();

  return (
    <div className={styles.root}>
      <ConstaHeader
        className={styles.body}
        leftSide={
          <>
            <HeaderModule>
              <HeaderButton
                onClick={toggleMenu}
                iconSize="m"
                iconLeft={IconHamburger}
              />
            </HeaderModule>
            <HeaderModule indent="m">
              {/* <Link to={'/'}>
                <Typography size={'2xl'} weight={'bold'} view={'brand'}>
                  Lime
                </Typography>
              </Link> */}
              <HeaderLogo>
                <Link to="/">
                  <svg
                    width="247"
                    height="32"
                    viewBox="0 0 247 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <g clipPath="url(#clip0)">
                      <path
                        d="M13.0003 31.0008C20.1802 31.0008 26.0006 25.2298 26.0006 18.111C26.0006 10.9922 20.1802 5.22119 13.0003 5.22119C5.82044 5.22119 0 10.9922 0 18.111C0 25.2298 5.82044 31.0008 13.0003 31.0008Z"
                        fill="url(#paint0_linear)"
                      />
                      <path
                        d="M25.217 22.5285V22.529C25.1554 22.6964 25.0901 22.8621 25.0217 23.0262C24.1599 25.0965 22.7697 26.8958 21.0176 28.2584C20.3262 28.7961 19.5785 29.266 18.7852 29.6579C17.2167 30.4313 15.4688 30.9 13.6196 30.9858C11.3974 30.2355 9.30987 28.9813 7.53809 27.2241C2.18306 21.9146 1.46089 13.7503 5.37265 7.67162C5.98184 6.72407 6.70401 5.8276 7.53814 5L8.54473 5.99803L9.08492 6.53414L9.48237 6.92821L9.93606 7.37753V7.37804L18.252 15.6233H18.2525V15.6238L19.2379 16.6008H19.2384V16.6013L25.217 22.5285Z"
                        fill="#4AC688"
                      />
                      <path
                        d="M25.2169 22.5291C25.1554 22.6965 25.0901 22.8622 25.0216 23.0263C24.1599 25.0966 22.7696 26.8959 21.0175 28.2585C20.3261 28.7962 19.5785 29.266 18.7852 29.658C15.2751 29.6685 11.7624 28.3459 9.08434 25.6911C3.74945 20.401 3.74945 11.8243 9.08486 6.53418L9.93599 7.37808L18.2519 15.6233L18.2524 15.6238L25.2169 22.5291Z"
                        fill="#C9F4C9"
                      />
                      <path
                        d="M25.217 22.5287V22.5292C25.1554 22.6966 25.0901 22.8623 25.0217 23.0264C24.1599 25.0966 22.7697 26.896 21.0176 28.2586C20.4291 28.3665 19.8343 28.4317 19.2378 28.4548C18.9099 28.468 18.5804 28.468 18.2525 28.4543C15.3828 28.3428 12.5456 27.2532 10.2915 25.1856C10.1716 25.0761 10.0527 24.9625 9.93601 24.8467C9.81928 24.731 9.70466 24.6131 9.59428 24.4943C7.50895 22.2593 6.41002 19.4457 6.29749 16.601C6.28371 16.2753 6.28371 15.9491 6.29698 15.624C6.40945 12.7782 7.50838 9.96508 9.59428 7.73015C9.70466 7.61127 9.81872 7.49391 9.93601 7.37817L18.2519 15.6234H18.2525V15.6239L19.2378 16.6009H19.2383V16.6014L25.217 22.5287Z"
                        fill="#5BD65B"
                      />
                      <path
                        d="M25.217 22.5291C25.1554 22.6964 25.0901 22.8621 25.0217 23.0263L9.13425 7.2739L9.48232 6.92822L9.93601 7.37805L18.2519 15.6233L18.2525 15.6238L25.217 22.5291Z"
                        fill="#C9F4C9"
                      />
                      <path
                        d="M18.2527 15.6238L19.2385 16.6012L19.238 17.2919V29.1007L18.2522 29.1003V28.4544V17.2924V16.6012V16.3145V15.9099L18.2527 15.6238Z"
                        fill="#C9F4C9"
                      />
                      <path
                        d="M19.094 16.4578L18.3968 15.7666L9.13425 24.9504L9.83137 25.6416L19.094 16.4578Z"
                        fill="#C9F4C9"
                      />
                      <path
                        d="M18.2522 15.6233L19.2385 16.6012H18.9494H18.5413H5.64599L5.64548 15.6238H6.29692H17.5555L18.2522 15.6233Z"
                        fill="#C9F4C9"
                      />
                      <path
                        d="M25.2171 22.5287C25.1556 22.696 25.0908 22.8618 25.0218 23.0259C24.1643 25.0867 22.7831 26.8792 21.0422 28.2397C20.3518 28.7789 19.6058 29.2503 18.813 29.6439C17.2471 30.4209 15.5014 30.8939 13.6537 30.9844C12.8779 30.7245 12.1181 30.4031 11.3827 30.02C18.4548 26.785 21.3971 18.7412 21.3971 18.7412L25.2171 22.5287Z"
                        fill="#32A066"
                      />
                      <path
                        d="M25.2171 22.5287C25.1556 22.696 25.0908 22.8618 25.0218 23.0259C24.1644 25.0867 22.7831 26.8792 21.0422 28.2397C20.3518 28.7789 19.6058 29.2503 18.813 29.6439C17.081 29.6533 15.3475 29.3376 13.7132 28.6969C19.1075 25.0009 21.3972 18.7412 21.3972 18.7412L25.2171 22.5287Z"
                        fill="#ADDBAD"
                      />
                      <path
                        d="M25.2172 22.5285C25.1556 22.6959 25.0909 22.8616 25.0219 23.0257C24.1644 25.0865 22.7831 26.879 21.0422 28.2395C20.4436 28.3505 19.8382 28.4178 19.2317 28.4415C18.9037 28.4546 18.5748 28.4546 18.2463 28.441C17.08 28.3957 15.919 28.1889 14.8004 27.8197C19.1638 24.2936 21.1722 19.2635 21.3791 18.7231L25.2172 22.5285Z"
                        fill="#4CC14C"
                      />
                      <path
                        d="M18.2463 24.2192C18.6076 23.7415 18.9356 23.2691 19.2317 22.8145V29.0873L18.2463 29.0868V24.2192Z"
                        fill="#ADDBAD"
                      />
                      <path
                        d="M25.2171 22.5285C25.1556 22.6959 25.0908 22.8616 25.0219 23.0257L21.1775 19.214C21.2831 18.9699 21.3494 18.8005 21.3791 18.7231L25.2171 22.5285Z"
                        fill="#ADDBAD"
                      />
                      <path
                        d="M37.528 26L44.128 10.49H47.252L53.852 26H50.31L48.902 22.546H42.39L40.982 26H37.528ZM43.6 19.554H47.692L45.646 14.56L43.6 19.554ZM55.8769 26V14.208H59.2209V19.048L63.4449 14.208H67.2949L62.9609 19.048L67.8449 26H63.8849L60.7389 21.512L59.2209 23.162V26H55.8769ZM72.6701 26.22C71.5114 26.22 70.5434 25.8973 69.7661 25.252C69.0034 24.6067 68.6221 23.712 68.6221 22.568C68.6221 21.3213 69.0474 20.3827 69.8981 19.752C70.7634 19.1213 71.9221 18.806 73.3741 18.806C74.3567 18.806 75.3174 18.9673 76.2561 19.29V19.092C76.2561 17.6547 75.4127 16.936 73.7261 16.936C72.7141 16.936 71.6287 17.1487 70.4701 17.574L69.6341 15.022C71.0714 14.3913 72.5967 14.076 74.2101 14.076C75.9847 14.076 77.3121 14.516 78.1921 15.396C79.0427 16.2467 79.4681 17.5007 79.4681 19.158V26H76.2341V24.724C75.3394 25.7213 74.1514 26.22 72.6701 26.22ZM73.6821 23.91C74.4594 23.91 75.0901 23.7193 75.5741 23.338C76.0581 22.942 76.3001 22.4433 76.3001 21.842V21.248C75.6694 20.9547 74.9581 20.808 74.1661 20.808C73.4327 20.808 72.8607 20.9547 72.4501 21.248C72.0541 21.5267 71.8561 21.9373 71.8561 22.48C71.8561 22.92 72.0247 23.272 72.3621 23.536C72.6994 23.7853 73.1394 23.91 73.6821 23.91ZM85.7336 23.14H89.7596V17.068H86.6136V17.332C86.5843 19.8693 86.2909 21.8053 85.7336 23.14ZM91.4976 26H84.1056L83.8636 28.772H81.0476V23.14H82.3236C83.0863 21.512 83.4676 18.872 83.4676 15.22V14.208H93.1036V23.14H94.7096L94.3136 28.772H91.4976V26ZM102.113 26.264C100.324 26.264 98.85 25.6993 97.6913 24.57C96.5326 23.426 95.9533 21.9447 95.9533 20.126C95.9533 18.41 96.5033 16.958 97.6033 15.77C98.7033 14.582 100.097 13.988 101.783 13.988C103.646 13.988 105.069 14.604 106.051 15.836C107.034 17.068 107.525 18.586 107.525 20.39C107.525 20.566 107.511 20.8593 107.481 21.27H99.2753C99.4366 22.018 99.7666 22.59 100.265 22.986C100.764 23.382 101.395 23.58 102.157 23.58C103.199 23.58 104.152 23.1767 105.017 22.37L106.931 24.064C105.743 25.5307 104.137 26.264 102.113 26.264ZM99.2313 19.18H104.269C104.167 18.4173 103.895 17.8087 103.455 17.354C103.03 16.8993 102.473 16.672 101.783 16.672C101.109 16.672 100.544 16.8993 100.089 17.354C99.6493 17.794 99.3633 18.4027 99.2313 19.18ZM110.017 26V14.208H113.405L116.595 19.158L119.829 14.208H123.217V26H119.829V18.916L116.551 23.756L113.317 18.982V26H110.017ZM137.195 14.208V26H133.961V19.136L129.363 26H126.217V14.208H129.451V21.094L134.049 14.208H137.195ZM150.632 14.208V26H147.288V22.216H145.484L142.998 26H139.126L142.14 21.666C140.497 21.0353 139.676 19.862 139.676 18.146C139.676 16.9433 140.094 15.99 140.93 15.286C141.766 14.5673 142.939 14.208 144.45 14.208H150.632ZM145.022 19.796H147.288V16.826H145C144.384 16.826 143.907 16.958 143.57 17.222C143.232 17.4713 143.064 17.838 143.064 18.322C143.064 18.7913 143.232 19.158 143.57 19.422C143.922 19.6713 144.406 19.796 145.022 19.796Z"
                        fill="url(#paint1_linear)"
                      />
                      <path
                        d="M37.528 26L44.128 10.49H47.252L53.852 26H50.31L48.902 22.546H42.39L40.982 26H37.528ZM43.6 19.554H47.692L45.646 14.56L43.6 19.554ZM55.8769 26V14.208H59.2209V19.048L63.4449 14.208H67.2949L62.9609 19.048L67.8449 26H63.8849L60.7389 21.512L59.2209 23.162V26H55.8769ZM72.6701 26.22C71.5114 26.22 70.5434 25.8973 69.7661 25.252C69.0034 24.6067 68.6221 23.712 68.6221 22.568C68.6221 21.3213 69.0474 20.3827 69.8981 19.752C70.7634 19.1213 71.9221 18.806 73.3741 18.806C74.3567 18.806 75.3174 18.9673 76.2561 19.29V19.092C76.2561 17.6547 75.4127 16.936 73.7261 16.936C72.7141 16.936 71.6287 17.1487 70.4701 17.574L69.6341 15.022C71.0714 14.3913 72.5967 14.076 74.2101 14.076C75.9847 14.076 77.3121 14.516 78.1921 15.396C79.0427 16.2467 79.4681 17.5007 79.4681 19.158V26H76.2341V24.724C75.3394 25.7213 74.1514 26.22 72.6701 26.22ZM73.6821 23.91C74.4594 23.91 75.0901 23.7193 75.5741 23.338C76.0581 22.942 76.3001 22.4433 76.3001 21.842V21.248C75.6694 20.9547 74.9581 20.808 74.1661 20.808C73.4327 20.808 72.8607 20.9547 72.4501 21.248C72.0541 21.5267 71.8561 21.9373 71.8561 22.48C71.8561 22.92 72.0247 23.272 72.3621 23.536C72.6994 23.7853 73.1394 23.91 73.6821 23.91ZM85.7336 23.14H89.7596V17.068H86.6136V17.332C86.5843 19.8693 86.2909 21.8053 85.7336 23.14ZM91.4976 26H84.1056L83.8636 28.772H81.0476V23.14H82.3236C83.0863 21.512 83.4676 18.872 83.4676 15.22V14.208H93.1036V23.14H94.7096L94.3136 28.772H91.4976V26ZM102.113 26.264C100.324 26.264 98.85 25.6993 97.6913 24.57C96.5326 23.426 95.9533 21.9447 95.9533 20.126C95.9533 18.41 96.5033 16.958 97.6033 15.77C98.7033 14.582 100.097 13.988 101.783 13.988C103.646 13.988 105.069 14.604 106.051 15.836C107.034 17.068 107.525 18.586 107.525 20.39C107.525 20.566 107.511 20.8593 107.481 21.27H99.2753C99.4366 22.018 99.7666 22.59 100.265 22.986C100.764 23.382 101.395 23.58 102.157 23.58C103.199 23.58 104.152 23.1767 105.017 22.37L106.931 24.064C105.743 25.5307 104.137 26.264 102.113 26.264ZM99.2313 19.18H104.269C104.167 18.4173 103.895 17.8087 103.455 17.354C103.03 16.8993 102.473 16.672 101.783 16.672C101.109 16.672 100.544 16.8993 100.089 17.354C99.6493 17.794 99.3633 18.4027 99.2313 19.18ZM110.017 26V14.208H113.405L116.595 19.158L119.829 14.208H123.217V26H119.829V18.916L116.551 23.756L113.317 18.982V26H110.017ZM137.195 14.208V26H133.961V19.136L129.363 26H126.217V14.208H129.451V21.094L134.049 14.208H137.195ZM150.632 14.208V26H147.288V22.216H145.484L142.998 26H139.126L142.14 21.666C140.497 21.0353 139.676 19.862 139.676 18.146C139.676 16.9433 140.094 15.99 140.93 15.286C141.766 14.5673 142.939 14.208 144.45 14.208H150.632ZM145.022 19.796H147.288V16.826H145C144.384 16.826 143.907 16.958 143.57 17.222C143.232 17.4713 143.064 17.838 143.064 18.322C143.064 18.7913 143.232 19.158 143.57 19.422C143.922 19.6713 144.406 19.796 145.022 19.796Z"
                        fill="black"
                        fillOpacity="0.09"
                      />
                    </g>
                    <defs>
                      <linearGradient
                        id="paint0_linear"
                        x1="0"
                        y1="18.111"
                        x2="26.0006"
                        y2="18.111"
                        gradientUnits="userSpaceOnUse"
                      >
                        <stop stopColor="#0F8F62" />
                        <stop offset="0.458333" stopColor="#0F8F62" />
                        <stop offset="1" stopColor="#2BB47E" />
                      </linearGradient>
                      <linearGradient
                        id="paint1_linear"
                        x1="37"
                        y1="35"
                        x2="49.8797"
                        y2="-20.5633"
                        gradientUnits="userSpaceOnUse"
                      >
                        <stop stopColor="#58CC01" />
                        <stop offset="1" stopColor="#57D4F6" />
                      </linearGradient>
                      <clipPath id="clip0">
                        <rect width="247" height="32" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </Link>
              </HeaderLogo>
            </HeaderModule>
          </>
        }
        rightSide={
          <>
            <HeaderModule indent="m">
              <HeaderLogin
                isLogged={isLogged}
                isMinified={isMobile}
                personName="3.130 mBTC"
                personInfo="Баланс"
                personAvatarUrl={bitcoin}
                className={styles.clickBlock}
              />
            </HeaderModule>

            <HeaderModule indent="s" className={styles.relative}>
              <div ref={ref}>
                <HeaderLogin
                  isLogged={isLogged}
                  onClick={() => setOpen(!isOpen)}
                  isMinified={isMobile}
                  personName={`${profile.name} ${profile.surname}`}
                  personInfo="8 уровень"
                  className={styles.clickBlock}
                />
              </div>
              {isOpen && (
                <UserDropdown
                  clickOutside={() => setOpen(false)}
                  targetRef={ref}
                  changeTheme={() =>
                    setTheme(theme !== 'dark' ? 'dark' : 'default')
                  }
                  theme={theme}
                />
              )}
            </HeaderModule>
          </>
        }
      />
    </div>
  );
};

export default Header;
